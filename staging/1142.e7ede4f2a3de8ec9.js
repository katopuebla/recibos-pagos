"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1142],{5441:(y,b,c)=>{c.d(b,{a:()=>p});var l,n=c(316),a=c(7404);function C(d,t){if(1&d&&(a.j41(0,"div",4),a.EFF(1),a.k0s()),2&d){const m=a.XpG();a.R7$(),a.SpI(" ",m.userName," ")}}class p{constructor(){this.user=null,this.size="medium",this.initials="",this.userName=""}ngOnInit(){this.loadUserData()}ngOnChanges(){this.loadUserData()}loadUserData(){if(this.user)this.userName=this.user.NOMBRE||"",this.initials=this.getInitials(this.userName);else{const t=localStorage.getItem("user");if(t){const m=JSON.parse(t);this.userName=m.NOMBRE||"",this.initials=this.getInitials(this.userName)}else this.userName="",this.initials=""}}getInitials(t){if(!t)return"";const m=t.trim().split(" ");return 1===m.length?m[0].charAt(0).toUpperCase():(m[0].charAt(0)+m[m.length-1].charAt(0)).toUpperCase()}getSizeClass(){return`avatar-${this.size}`}}(l=p).\u0275fac=function(t){return new(t||l)},l.\u0275cmp=a.VBU({type:l,selectors:[["app-user-avatar"]],inputs:{user:"user",size:"size"},features:[a.OA$],decls:5,vars:5,consts:[[1,"user-avatar-container",3,"title","id"],[1,"user-avatar",3,"ngClass"],[1,"initials"],["class","user-tooltip",4,"ngIf"],[1,"user-tooltip"]],template:function(t,m){1&t&&(a.j41(0,"div",0)(1,"div",1)(2,"span",2),a.EFF(3),a.k0s()(),a.DNE(4,C,2,1,"div",3),a.k0s()),2&t&&(a.Y8G("title",m.userName)("id","user-avatar-"+m.size),a.R7$(),a.Y8G("ngClass",m.getSizeClass()),a.R7$(2),a.JRh(m.initials),a.R7$(),a.Y8G("ngIf",m.userName))},dependencies:[n.MD,n.YU,n.bT],styles:['@charset "UTF-8";.user-avatar-container[_ngcontent-%COMP%]{position:relative;display:inline-block;cursor:pointer}.user-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;font-weight:700;box-shadow:0 2px 8px #00000026;transition:all .3s ease;border:2px solid rgba(255,255,255,.2)}.user-avatar[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 4px 12px #00000040}.initials[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;letter-spacing:.5px}.avatar-small[_ngcontent-%COMP%]{width:32px;height:32px;font-size:12px}.avatar-medium[_ngcontent-%COMP%]{width:40px;height:40px;font-size:14px}.avatar-large[_ngcontent-%COMP%]{width:48px;height:48px;font-size:16px}.user-tooltip[_ngcontent-%COMP%]{position:absolute;bottom:100%;left:50%;transform:translate(-50%);background:#000c;color:#fff;padding:8px 12px;border-radius:6px;font-size:12px;white-space:nowrap;opacity:0;visibility:hidden;transition:all .3s ease;z-index:1000;margin-bottom:8px;box-shadow:0 2px 8px #0003}.user-tooltip[_ngcontent-%COMP%]:after{content:"";position:absolute;top:100%;left:50%;transform:translate(-50%);border:5px solid transparent;border-top-color:#000c}.user-avatar-container[_ngcontent-%COMP%]:hover   .user-tooltip[_ngcontent-%COMP%]{opacity:1;visibility:visible}@media (max-width: 768px){.avatar-small[_ngcontent-%COMP%]{width:28px;height:28px;font-size:10px}.avatar-medium[_ngcontent-%COMP%]{width:36px;height:36px;font-size:12px}.avatar-large[_ngcontent-%COMP%]{width:44px;height:44px;font-size:14px}}']})},1142:(y,b,c)=>{c.r(b),c.d(b,{GastosPageModule:()=>k});var f,n=c(9618),a=c(316),l=c(496),C=c(4908),p=c(9204),d=c(7568),t=c(7404),m=c(9949),M=c(3511);function I(r,o){if(1&r&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&r){const e=o.$implicit;t.Y8G("value",e),t.R7$(),t.SpI("",e.Nombre," ")}}function P(r,o){if(1&r){const e=t.RV6();t.j41(0,"ion-button",22),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,h=t.XpG();return t.Njj(h.removeInputField(s))}),t.nrm(1,"ion-icon",23),t.EFF(2," eliminar "),t.k0s()}}function O(r,o){if(1&r&&(t.j41(0,"section",17)(1,"ion-item-group")(2,"ion-item-divider",18),t.EFF(3),t.k0s(),t.j41(4,"ion-item"),t.nrm(5,"ion-input",19),t.k0s(),t.j41(6,"ion-item"),t.nrm(7,"ion-input",20),t.k0s(),t.j41(8,"ion-item")(9,"ion-item"),t.nrm(10,"ion-textarea",10),t.k0s()(),t.DNE(11,P,3,0,"ion-button",21),t.k0s()()),2&r){const e=o.index,i=t.XpG();t.Y8G("formGroupName",e),t.R7$(3),t.SpI("Conceptos #",e+1,""),t.R7$(8),t.Y8G("ngIf",i.conceptoForm.length>1)}}class G extends d.L{constructor(o,e,i,s,h,_){super(h),this.modalCtrl=o,this.actionSheet=e,this.formBuilder=i,this.service=s,this.toastCtrl=_,this.gasto={},this.gastoDetalle={},this.gastoDetalles=[],this.conceptos=[],this.categorias=[],this.date=new Date,this.today=new Date(this.date.getTime()-6e4*this.date.getTimezoneOffset()),this.gastosConfirm=[],this.fields=this.formBuilder.group({categoria:["",l.k0.required],nombre:["",l.k0.required],fecha:["",l.k0.required],monto:["",l.k0.required],comentario:[""],conceptos:this.formBuilder.array([this.frmConceptos()])})}frmConceptos(){return this.formBuilder.group({mes:["",l.k0.required],monto:["",l.k0.required],comentario:[""]})}get conceptoForm(){return this.fields.get("conceptos")}logForm(){console.log(this.fields.value)}ngOnInit(){this.service.getSpreadSheetId().then(()=>this.initCategorias());const o=this.today.toJSON().split("T")[0];this.fields.patchValue({fecha:o})}initCategorias(){this.showing(),this.service.getCategoriaDef().subscribe(o=>{this.categorias=o||[],this.dismiss()})}onChange(o){const e=o.detail.value;if(e){let i;i=this.categorias&&this.categorias.find(s=>s.Nombre===e.Nombre)||{},this.fields.patchValue({nombre:i.PersonaServicio})}}onChangeMonto(o,e){const i=o.detail.value;if(i){const s=this.fields.controls.conceptos,_=(s.at(e).value.monto,this.fields.value.fecha),U=this.fields.value.comentario;s.at(e).patchValue({mes:_,monto:i,comentario:U})}}onSave(o){var e=this;return(0,p.A)(function*(){yield(yield e.actionSheet.create({header:"\xbfDesea guardar el gasto?",buttons:[{text:"Guardar",icon:"save",handler:()=>{e.save(o)}},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}save(o){let e=new Date(this.gasto.Fecha||this.today);this.gasto.Fecha=e.toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),this.fillEvent(o),this.service.save(this.gasto,this.gastoDetalles).subscribe({next:i=>{this.meesageToast("Se guardo exitosamente"),this.dismiss(),this.calOther(this.gastoDetalles)},error:i=>{this.meesageToast("No se pudo guardar el dato"),console.log("Error: ",i),this.dismiss()}}),this.showing()}fillEvent(o){this.gasto.Categoria=o.categoria.Nombre,this.gasto.Fecha=o.fecha,this.gasto.Nombre=o.nombre,this.gasto.Monto=o.monto,this.gasto.Comentario=o.comentario;var e=o.conceptos;this.gastoDetalles=[],e&&e.forEach(i=>{var s={};s.Categoria=o.categoria.Nombre,s.Fecha=i.mes,s.Nombre=o.nombre,s.Monto=i.monto,s.Comentario=i.comentario,this.gastoDetalles.push(s)})}calOther(o){var e=this;return(0,p.A)(function*(){yield(yield e.actionSheet.create({header:"\xbfDesea agregar otro gasto ?",buttons:[{text:"Otro gasto",icon:"add-outline",role:"other",handler:()=>{e.gastosConfirm.push(...o),e.fields.reset();const s=e.today.toJSON().split("T")[0];e.fields.patchValue({fecha:s})}},{text:"Salir",icon:"checkmark",role:"confirm",handler:()=>{e.gastosConfirm.push(...o),e.confirm(e.gastosConfirm)}}]})).present()})()}removeInputField(o){this.fields.controls.conceptos.removeAt(o)}addNewInputField(){const o=this.fields.controls.conceptos;let e=0;o.controls.forEach(i=>{e+=i.value.monto}),o.push(this.frmConceptos()),this.updateMountConcepto(e)}updateMountConcepto(o=0){const i=this.fields.value.monto-o,s=this.fields.controls.conceptos,h=this.today.toJSON().split("T")[0];s.at(s.length-1).patchValue({mes:h,monto:i})}meesageToast(o){this.toastCtrl.presentToast(o,"top")}close(){this.modalCtrl.dismiss(null,"cancel")}confirm(o){this.modalCtrl.dismiss(o,"confirm")}}(f=G).\u0275fac=function(o){return new(o||f)(t.rXU(n.W3),t.rXU(n.GD),t.rXU(l.ok),t.rXU(m.j),t.rXU(n.Xi),t.rXU(M.w))},f.\u0275cmp=t.VBU({type:f,selectors:[["app-add-gastos"]],standalone:!1,features:[t.Vt3],decls:27,vars:4,consts:[["slot","start"],["ion-button","",3,"click"],["name","close"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["label","Categoria","labelPlacement","floating","interface","popover","formControlName","categoria","placeholder","Seleciona categoria",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["label","Concepto","labelPlacement","floating","type","text","formControlName","nombre","placeholder","Nombre o Concepto"],["label","Fecha","labelPlacement","floating","id","fecha","type","date","formControlName","fecha"],["label","Monto","labelPlacement","floating","type","number","formControlName","monto",3,"ionChange"],["label","Comentario","labelPlacement","floating","formControlName","comentario","placeholder","comentario"],["formArrayName","conceptos","margin-bottom",""],[3,"formGroupName",4,"ngFor","ngForOf"],["size","small","fill","clear","color","primary",3,"click"],["slot","start","name","add"],["type","submit","expand","block",3,"disabled"],[3,"value"],[3,"formGroupName"],["color","light"],["label","Mes:","labelPlacement","floating","id","mes","type","date","maxlength","50","formControlName","mes"],["label","Monto:","labelPlacement","floating","id","monto","type","number","maxlength","50","formControlName","monto"],["size","small","fill","clear","color","danger",3,"click",4,"ngIf"],["size","small","fill","clear","color","danger",3,"click"],["slot","start","name","close"]],template:function(o,e){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Agregar Gastos"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return e.close()}),t.nrm(6,"ion-icon",2),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"form",4),t.bIt("ngSubmit",function(){return e.onSave(e.fields.value)}),t.j41(9,"ion-item")(10,"ion-select",5),t.bIt("ionChange",function(s){return e.onChange(s)}),t.DNE(11,I,2,2,"ion-select-option",6),t.k0s()(),t.j41(12,"ion-item"),t.nrm(13,"ion-input",7),t.k0s(),t.j41(14,"ion-item"),t.nrm(15,"ion-input",8),t.k0s(),t.j41(16,"ion-item")(17,"ion-input",9),t.bIt("ionChange",function(s){return e.onChangeMonto(s,0)}),t.k0s()(),t.j41(18,"ion-item"),t.nrm(19,"ion-textarea",10),t.k0s(),t.j41(20,"div",11),t.DNE(21,O,12,3,"section",12),t.k0s(),t.j41(22,"ion-button",13),t.bIt("click",function(){return e.addNewInputField()}),t.nrm(23,"ion-icon",14),t.EFF(24," nuevo concepto "),t.k0s(),t.j41(25,"ion-button",15),t.EFF(26,"Agregar"),t.k0s()()()),2&o&&(t.R7$(8),t.Y8G("formGroup",e.fields),t.R7$(3),t.Y8G("ngForOf",e.categorias),t.R7$(10),t.Y8G("ngForOf",e.conceptoForm.controls),t.R7$(4),t.Y8G("disabled",!e.fields.valid))},dependencies:[a.Sq,a.bT,l.qT,l.BC,l.cb,l.tU,n.Jm,n.QW,n.W9,n.eU,n.iq,n.$w,n.uz,n.Dg,n.jh,n.Nm,n.Ip,n.nc,n.BC,n.ai,n.su,n.Je,n.Gw,l.j4,l.JD,l.$R,l.v8],encapsulation:2});var v,u,D=c(6482),F=c(5441),j=c(4435);function T(r,o){if(1&r){const e=t.RV6();t.j41(0,"ion-fab",10)(1,"ion-fab-button",11),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.openModal({new:"Add"}))}),t.nrm(2,"ion-icon",12),t.k0s()()}}function S(r,o){if(1&r&&(t.j41(0,"ion-item")(1,"ion-label")(2,"div",14)(3,"h3"),t.EFF(4),t.k0s()(),t.j41(5,"p"),t.EFF(6),t.nI1(7,"currency"),t.k0s()()()),2&r){const e=o.$implicit;t.R7$(4),t.Lme("",e.Nombre," ",e.Comentario?" ("+e.Comentario+") ":"",""),t.R7$(2),t.Lme("",e.Categoria," -- ",t.bMT(7,4,e.Monto)," ")}}function A(r,o){if(1&r&&(t.j41(0,"ion-item-group")(1,"ion-item-divider",13),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.DNE(4,S,8,6,"ion-item",9),t.k0s()),2&r){const e=o.$implicit;t.R7$(2),t.SpI(" ",t.i5U(3,2,e.header,"MMM.dd.yy")," "),t.R7$(2),t.Y8G("ngForOf",e.details)}}class x{constructor(o,e,i,s){this.modalCtrl=o,this.navCtrl=e,this.service=i,this.loadUtil=s,this.items=[],this.itemsBackup=[],this.role=""}ngOnInit(){this.service.getSpreadSheetId().then(()=>this.getdata());const o=localStorage.getItem("user");this.role=o?JSON.parse(o).ROLE:""}doRefresh(o){this.service.getFullDataDetail().subscribe(e=>{this.items=[...e],this.itemsBackup=[...this.items],o.target.complete()})}getdata(){var o=this;return(0,p.A)(function*(){o.loadUtil.showing(),yield o.service.getFullDataDetail().subscribe(e=>{o.items=[...e],o.itemsBackup=[...o.items],o.loadUtil.dismiss()})})()}getItems(o){this.items=this.itemsBackup;const e=o.target.value;e&&""!=e.trim()&&(this.items=this.items.filter(i=>i.Categoria&&i.Categoria.toLowerCase().indexOf(e.toLowerCase())>-1||i.Nombre&&i.Nombre.toLowerCase().indexOf(e.toLowerCase())>-1))}openModal(o){var e=this;return(0,p.A)(function*(){const i=yield e.modalCtrl.create({component:G,componentProps:{detail:o.detail}});i.present();const{data:s,role:h}=yield i.onWillDismiss();"confirm"===h&&s&&Array.isArray(s)&&(e.items.push(...s),e.items=[...e.items],e.itemsBackup=[...e.items],e.service.gastosDetalle$.next(e.items))})()}}(v=x).\u0275fac=function(o){return new(o||v)(t.rXU(n.W3),t.rXU(D.q9),t.rXU(m.j),t.rXU(d.L))},v.\u0275cmp=t.VBU({type:v,selectors:[["app-gastos"]],standalone:!1,decls:14,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","end"],["id","user-avatar","size","medium"],[1,"ion-padding"],["slot","fixed","vertical","bottom","horizontal","end",4,"ngIf"],["id","gastos-searchbar",3,"ionInput"],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-dropdown","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refrescando..."],[4,"ngFor","ngForOf"],["slot","fixed","vertical","bottom","horizontal","end"],["id","add-gasto-fab-button",3,"click"],["name","add"],["color","light"],["ion-text","","color","primary"]],template:function(o,e){1&o&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3," Gastos "),t.k0s(),t.j41(4,"ion-buttons",2),t.nrm(5,"app-user-avatar",3),t.k0s()()(),t.j41(6,"ion-content",4),t.DNE(7,T,3,0,"ion-fab",5),t.j41(8,"ion-list-header")(9,"ion-searchbar",6),t.bIt("ionInput",function(s){return e.getItems(s)}),t.k0s()(),t.j41(10,"ion-refresher",7),t.bIt("ionRefresh",function(s){return e.doRefresh(s)}),t.nrm(11,"ion-refresher-content",8),t.k0s(),t.DNE(12,A,5,5,"ion-item-group",9),t.nI1(13,"groupBy"),t.k0s()),2&o&&(t.Y8G("translucent",!0),t.R7$(7),t.Y8G("ngIf","reader"!=e.role),t.R7$(5),t.Y8G("ngForOf",t.brH(13,3,e.items,"Fecha","reverse")))},dependencies:[n.QW,n.W9,n.Q8,n.YW,n.eU,n.iq,n.uz,n.Dg,n.jh,n.he,n.AF,n.To,n.Ki,n.S1,n.BC,n.ai,n.Gw,a.Sq,a.bT,F.a,a.oe,a.vh,j.l],encapsulation:2});const R=[{path:"",component:x}];class N{}var g;(u=N).\u0275fac=function(o){return new(o||u)},u.\u0275mod=t.$C({type:u}),u.\u0275inj=t.G2t({imports:[C.iI.forChild(R),C.iI]});class k{}(g=k).\u0275fac=function(o){return new(o||g)},g.\u0275mod=t.$C({type:g}),g.\u0275inj=t.G2t({imports:[n.bv,a.MD,l.YN,N,F.a]})}}]);
//# sourceMappingURL=1142.e7ede4f2a3de8ec9.js.map