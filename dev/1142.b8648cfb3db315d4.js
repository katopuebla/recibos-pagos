"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1142],{1142:(U,b,l)=>{l.r(b),l.d(b,{GastosPageModule:()=>y});var u,i=l(9618),m=l(316),r=l(496),C=l(4908),f=l(9204),v=l(7568),t=l(7404),G=l(9949),N=l(3511);function I(a,o){if(1&a&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&a){const e=o.$implicit;t.Y8G("value",e),t.R7$(),t.SpI("",e.Nombre," ")}}function j(a,o){if(1&a){const e=t.RV6();t.j41(0,"ion-button",22),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,c=t.XpG();return t.Njj(c.removeInputField(s))}),t.nrm(1,"ion-icon",23),t.EFF(2," eliminar "),t.k0s()}}function T(a,o){if(1&a&&(t.j41(0,"section",17)(1,"ion-item-group")(2,"ion-item-divider",18),t.EFF(3),t.k0s(),t.j41(4,"ion-item"),t.nrm(5,"ion-input",19),t.k0s(),t.j41(6,"ion-item"),t.nrm(7,"ion-input",20),t.k0s(),t.j41(8,"ion-item")(9,"ion-item"),t.nrm(10,"ion-textarea",10),t.k0s()(),t.DNE(11,j,3,0,"ion-button",21),t.k0s()()),2&a){const e=o.index,n=t.XpG();t.Y8G("formGroupName",e),t.R7$(3),t.SpI("Conceptos #",e+1,""),t.R7$(8),t.Y8G("ngIf",n.conceptoForm.length>1)}}class _ extends v.L{constructor(o,e,n,s,c,g){super(c),this.modalCtrl=o,this.actionSheet=e,this.formBuilder=n,this.service=s,this.toastCtrl=g,this.gasto={},this.gastoDetalle={},this.gastoDetalles=[],this.conceptos=[],this.categorias=[],this.date=new Date,this.today=new Date(this.date.getTime()-6e4*this.date.getTimezoneOffset()),this.gastosConfirm=[],this.fields=this.formBuilder.group({categoria:["",r.k0.required],nombre:["",r.k0.required],fecha:["",r.k0.required],monto:["",r.k0.required],comentario:[""],conceptos:this.formBuilder.array([this.frmConceptos()])})}frmConceptos(){return this.formBuilder.group({mes:["",r.k0.required],monto:["",r.k0.required],comentario:[""]})}get conceptoForm(){return this.fields.get("conceptos")}logForm(){console.log(this.fields.value)}ngOnInit(){this.service.getSpreadSheetId().then(()=>this.initCategorias());const o=this.today.toJSON().split("T")[0];this.fields.patchValue({fecha:o})}initCategorias(){this.showing(),this.service.getCategoriaDef().subscribe(o=>{this.categorias=o||[],this.dismiss()})}onChange(o){const e=o.detail.value;if(e){let n;n=this.categorias&&this.categorias.find(s=>s.Nombre===e.Nombre)||{},this.fields.patchValue({nombre:n.PersonaServicio})}}onChangeMonto(o,e){const n=o.detail.value;if(n){const s=this.fields.controls.conceptos,g=(s.at(e).value.monto,this.fields.value.fecha),E=this.fields.value.comentario;s.at(e).patchValue({mes:g,monto:n,comentario:E})}}onSave(o){var e=this;return(0,f.A)(function*(){yield(yield e.actionSheet.create({header:"\xbfDesea guardar el gasto?",buttons:[{text:"Guardar",icon:"save",handler:()=>{e.save(o)}},{text:"Cancelar",icon:"close",role:"cancel"}]})).present()})()}save(o){let e=new Date(this.gasto.Fecha||this.today);this.gasto.Fecha=e.toLocaleString("es-MX",{timeZone:"America/Mexico_City"}),this.fillEvent(o),this.service.save(this.gasto,this.gastoDetalles).subscribe({next:n=>{this.meesageToast("Se guardo exitosamente"),this.dismiss(),this.calOther(this.gastoDetalles)},error:n=>{this.meesageToast("No se pudo guardar el dato"),console.log("Error: ",n),this.dismiss()}}),this.showing()}fillEvent(o){this.gasto.Categoria=o.categoria.Nombre,this.gasto.Fecha=o.fecha,this.gasto.Nombre=o.nombre,this.gasto.Monto=o.monto,this.gasto.Comentario=o.comentario;var e=o.conceptos;this.gastoDetalles=[],e&&e.forEach(n=>{var s={};s.Categoria=o.categoria.Nombre,s.Fecha=n.mes,s.Nombre=o.nombre,s.Monto=n.monto,s.Comentario=n.comentario,this.gastoDetalles.push(s)})}calOther(o){var e=this;return(0,f.A)(function*(){yield(yield e.actionSheet.create({header:"\xbfDesea agregar otro gasto ?",buttons:[{text:"Otro gasto",icon:"add-outline",role:"other",handler:()=>{e.gastosConfirm.push(...o),e.fields.reset();const s=e.today.toJSON().split("T")[0];e.fields.patchValue({fecha:s})}},{text:"Salir",icon:"checkmark",role:"confirm",handler:()=>{e.gastosConfirm.push(...o),e.confirm(e.gastosConfirm)}}]})).present()})()}removeInputField(o){this.fields.controls.conceptos.removeAt(o)}addNewInputField(){const o=this.fields.controls.conceptos;let e=0;o.controls.forEach(n=>{e+=n.value.monto}),o.push(this.frmConceptos()),this.updateMountConcepto(e)}updateMountConcepto(o=0){const n=this.fields.value.monto-o,s=this.fields.controls.conceptos,c=this.today.toJSON().split("T")[0];s.at(s.length-1).patchValue({mes:c,monto:n})}meesageToast(o){this.toastCtrl.presentToast(o,"top")}close(){this.modalCtrl.dismiss(null,"cancel")}confirm(o){this.modalCtrl.dismiss(o,"confirm")}}(u=_).\u0275fac=function(o){return new(o||u)(t.rXU(i.W3),t.rXU(i.GD),t.rXU(r.ok),t.rXU(G.j),t.rXU(i.Xi),t.rXU(N.w))},u.\u0275cmp=t.VBU({type:u,selectors:[["app-add-gastos"]],standalone:!1,features:[t.Vt3],decls:27,vars:4,consts:[["slot","start"],["ion-button","",3,"click"],["name","close"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["label","Categoria","labelPlacement","floating","interface","popover","formControlName","categoria","placeholder","Seleciona categoria",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],["label","Concepto","labelPlacement","floating","type","text","formControlName","nombre","placeholder","Nombre o Concepto"],["label","Fecha","labelPlacement","floating","id","fecha","type","date","formControlName","fecha"],["label","Monto","labelPlacement","floating","type","number","formControlName","monto",3,"ionChange"],["label","Comentario","labelPlacement","floating","formControlName","comentario","placeholder","comentario"],["formArrayName","conceptos","margin-bottom",""],[3,"formGroupName",4,"ngFor","ngForOf"],["size","small","fill","clear","color","primary",3,"click"],["slot","start","name","add"],["type","submit","expand","block",3,"disabled"],[3,"value"],[3,"formGroupName"],["color","light"],["label","Mes:","labelPlacement","floating","id","mes","type","date","maxlength","50","formControlName","mes"],["label","Monto:","labelPlacement","floating","id","monto","type","number","maxlength","50","formControlName","monto"],["size","small","fill","clear","color","danger",3,"click",4,"ngIf"],["size","small","fill","clear","color","danger",3,"click"],["slot","start","name","close"]],template:function(o,e){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Agregar Gastos"),t.k0s(),t.j41(4,"ion-buttons",0)(5,"ion-button",1),t.bIt("click",function(){return e.close()}),t.nrm(6,"ion-icon",2),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"form",4),t.bIt("ngSubmit",function(){return e.onSave(e.fields.value)}),t.j41(9,"ion-item")(10,"ion-select",5),t.bIt("ionChange",function(s){return e.onChange(s)}),t.DNE(11,I,2,2,"ion-select-option",6),t.k0s()(),t.j41(12,"ion-item"),t.nrm(13,"ion-input",7),t.k0s(),t.j41(14,"ion-item"),t.nrm(15,"ion-input",8),t.k0s(),t.j41(16,"ion-item")(17,"ion-input",9),t.bIt("ionChange",function(s){return e.onChangeMonto(s,0)}),t.k0s()(),t.j41(18,"ion-item"),t.nrm(19,"ion-textarea",10),t.k0s(),t.j41(20,"div",11),t.DNE(21,T,12,3,"section",12),t.k0s(),t.j41(22,"ion-button",13),t.bIt("click",function(){return e.addNewInputField()}),t.nrm(23,"ion-icon",14),t.EFF(24," nuevo concepto "),t.k0s(),t.j41(25,"ion-button",15),t.EFF(26,"Agregar"),t.k0s()()()),2&o&&(t.R7$(8),t.Y8G("formGroup",e.fields),t.R7$(3),t.Y8G("ngForOf",e.categorias),t.R7$(10),t.Y8G("ngForOf",e.conceptoForm.controls),t.R7$(4),t.Y8G("disabled",!e.fields.valid))},dependencies:[m.Sq,m.bT,r.qT,r.BC,r.cb,r.tU,i.Jm,i.QW,i.W9,i.eU,i.iq,i.$w,i.uz,i.Dg,i.jh,i.Nm,i.Ip,i.nc,i.BC,i.ai,i.su,i.Je,i.Gw,r.j4,r.JD,r.$R,r.v8],encapsulation:2});var p,d,S=l(6482),D=l(4435);function M(a,o){if(1&a){const e=t.RV6();t.j41(0,"ion-fab",8)(1,"ion-fab-button",9),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.openModal({new:"Add"}))}),t.nrm(2,"ion-icon",10),t.k0s()()}}function P(a,o){if(1&a&&(t.j41(0,"ion-item")(1,"ion-label")(2,"div",12)(3,"h3"),t.EFF(4),t.k0s()(),t.j41(5,"p"),t.EFF(6),t.nI1(7,"currency"),t.k0s()()()),2&a){const e=o.$implicit;t.R7$(4),t.Lme("",e.Nombre," ",e.Comentario?" ("+e.Comentario+") ":"",""),t.R7$(2),t.Lme("",e.Categoria," -- ",t.bMT(7,4,e.Monto)," ")}}function A(a,o){if(1&a&&(t.j41(0,"ion-item-group")(1,"ion-item-divider",11),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.DNE(4,P,8,6,"ion-item",7),t.k0s()),2&a){const e=o.$implicit;t.R7$(2),t.SpI(" ",t.i5U(3,2,e.header,"MMM.dd.yy")," "),t.R7$(2),t.Y8G("ngForOf",e.details)}}class F{constructor(o,e,n,s){this.modalCtrl=o,this.navCtrl=e,this.service=n,this.loadUtil=s,this.items=[],this.itemsBackup=[],this.role=""}ngOnInit(){this.service.getSpreadSheetId().then(()=>this.getdata());const o=localStorage.getItem("user");this.role=o?JSON.parse(o).ROLE:""}doRefresh(o){this.service.getFullDataDetail().subscribe(e=>{this.items=[...e],this.itemsBackup=[...this.items],o.target.complete()})}getdata(){var o=this;return(0,f.A)(function*(){o.loadUtil.showing(),yield o.service.getFullDataDetail().subscribe(e=>{o.items=[...e],o.itemsBackup=[...o.items],o.loadUtil.dismiss()})})()}getItems(o){this.items=this.itemsBackup;const e=o.target.value;e&&""!=e.trim()&&(this.items=this.items.filter(n=>n.Categoria&&n.Categoria.toLowerCase().indexOf(e.toLowerCase())>-1||n.Nombre&&n.Nombre.toLowerCase().indexOf(e.toLowerCase())>-1))}openModal(o){var e=this;return(0,f.A)(function*(){const n=yield e.modalCtrl.create({component:_,componentProps:{detail:o.detail}});n.present();const{data:s,role:c}=yield n.onWillDismiss();"confirm"===c&&s&&Array.isArray(s)&&(e.items.push(...s),e.items=[...e.items],e.itemsBackup=[...e.items],e.service.gastosDetalle$.next(e.items))})()}}(p=F).\u0275fac=function(o){return new(o||p)(t.rXU(i.W3),t.rXU(S.q9),t.rXU(G.j),t.rXU(v.L))},p.\u0275cmp=t.VBU({type:p,selectors:[["app-gastos"]],standalone:!1,decls:12,vars:7,consts:[[3,"translucent"],["color","primary"],[1,"ion-padding"],["slot","fixed","vertical","bottom","horizontal","end",4,"ngIf"],[3,"ionInput"],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-dropdown","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refrescando..."],[4,"ngFor","ngForOf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add"],["color","light"],["ion-text","","color","primary"]],template:function(o,e){1&o&&(t.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3," Gastos "),t.k0s()()(),t.j41(4,"ion-content",2),t.DNE(5,M,3,0,"ion-fab",3),t.j41(6,"ion-list-header")(7,"ion-searchbar",4),t.bIt("ionInput",function(s){return e.getItems(s)}),t.k0s()(),t.j41(8,"ion-refresher",5),t.bIt("ionRefresh",function(s){return e.doRefresh(s)}),t.nrm(9,"ion-refresher-content",6),t.k0s(),t.DNE(10,A,5,5,"ion-item-group",7),t.nI1(11,"groupBy"),t.k0s()),2&o&&(t.Y8G("translucent",!0),t.R7$(5),t.Y8G("ngIf","reader"!=e.role),t.R7$(5),t.Y8G("ngForOf",t.brH(11,3,e.items,"Fecha","reverse")))},dependencies:[i.W9,i.Q8,i.YW,i.eU,i.iq,i.uz,i.Dg,i.jh,i.he,i.AF,i.To,i.Ki,i.S1,i.BC,i.ai,i.Gw,m.Sq,m.bT,m.oe,m.vh,D.l],encapsulation:2});const R=[{path:"",component:F}];class k{}var h;(d=k).\u0275fac=function(o){return new(o||d)},d.\u0275mod=t.$C({type:d}),d.\u0275inj=t.G2t({imports:[C.iI.forChild(R),C.iI]});class y{}(h=y).\u0275fac=function(o){return new(o||h)},h.\u0275mod=t.$C({type:h}),h.\u0275inj=t.G2t({imports:[i.bv,m.MD,r.YN,k]})}}]);
//# sourceMappingURL=1142.b8648cfb3db315d4.js.map