{"version":3,"file":"4885.51cddc6f17715448.js","mappings":"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","names":["i0","row_r3","NOMBRE","$event","_r1","ctx_r1","onChangePrefijo","AddRecibosComponent_ion_item_9_ion_select_option_2_Template","prefijos","casa_r4","ID","row_r7","_r8","i_r6","index","removeInputField","_r5","onChangeConcepto","AddRecibosComponent_section_28_ion_select_option_6_Template","AddRecibosComponent_section_28_ion_button_13_Template","conceptos","conceptoForm","length","AddRecibosComponent","constructor","modalCtrl","actionSheetCtrl","formBuilder","service","loadingUtil","toastUtil","alertUtil","this","user","item","FOLIO","CASA","CANTIDAD","CONCEPTO","FECHA","CORREO","INPUT_TIMESTAMP","PREFIX","itemDetail","casas","data","sendEmail","date","Date","today","getTime","getTimezoneOffset","fields","group","prefijo","Validators","required","folio","casa","nombre","fecha","email","cantidad","array","frmConceptos","concepto","minLength","mes","monto","min","pattern","get","ngOnInit","getSpreadSheetId","then","formattedDate","toJSON","split","patchValue","inittial","showing","getMaxFolio","getFullDataDetail","subscribe","next","resp","Math","max","map","row","dismiss","error","err","showError","message","_this","userStr","localStorage","getItem","_ref","JSON","parse","getFullData","getConceptos","getPrefijos","find","_data$NOMBRE","_this$user","_this$user2","toUpperCase","ROLE","_asyncToGenerator","console","_x","apply","arguments","onChangeCasa","event","_casa","detail","value","EMAIL","_prefijo$FOLIO","_prefijo","i","control","controls","_monto","calMontoConcepto","at","getFirstDayOfMonth","sumMonto","forEach","getFullYear","getMonth","onSave","_recibo","_this2","create","header","buttons","text","role","icon","handler","save","present","_recibo$prefijo$PREFI","_recibo$prefijo","_prefix","PREFIJO","fillEvent","toLocaleDateString","meesageToast","log","convertMonth","confirm","_item$MES","yyyy","mm","dd","MES","isoString","MONTO","push","removeAt","addNewInputField","_message","presentToast","reciboDetalles","close","i1","i2","i3","i4","i5","i6","selectors","standalone","decls","vars","consts","template","rf","ctx","AddRecibosComponent_ion_item_9_Template","AddRecibosComponent_ion_select_option_16_Template","AddRecibosComponent_section_28_Template","valid","AlertUtil","alertCtrl","showSucess","factory","ɵfac","providedIn"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./src/app/components/add-recibos/add-recibos.component.html","./src/app/components/add-recibos/add-recibos.component.ts","./src/app/utils/alertUtil.ts"],"sourcesContent":["<ion-header>\n\t<ion-toolbar>\n\t\t<ion-title>Agregar Recibos</ion-title>\n\t\t<ion-buttons slot=\"start\">\n\t\t\t<ion-button (click)=\"close()\">\n\t\t\t<ion-icon name=\"close\" ></ion-icon>\n\t\t\t</ion-button>\n\t\t</ion-buttons>\n\t</ion-toolbar>\n</ion-header>\n\n<ion-content class=\"ion-padding\">\n\t<form [formGroup]=\"fields\" (ngSubmit)=\"onSave(fields.value)\">\n\t\t<ion-item disabled *ngIf=\"user?.ROLE === 'admin' || user?.ROLE === 'dev' || user?.ROLE === 'manager'\" >\n      <ion-select label=\"Prefix:\" labelPlacement=\"floating\"  interface=\"popover\"\n        id=\"prefijo\" formControlName=\"prefijo\" (ionChange)=\"onChangePrefijo($event)\">\n        <ion-select-option *ngFor=\"let row of prefijos\" [value]=\"row\">\n          {{row.NOMBRE}}\n        </ion-select-option>\n      </ion-select>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-input label=\"Folio\" labelPlacement=\"floating\" id=\"folio\" type=\"number\" formControlName=\"folio\">\n\t\t\t</ion-input>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-input label=\"Fecha\" labelPlacement=\"floating\" id=\"fecha\" type=\"date\" formControlName=\"fecha\"></ion-input>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-select label=\"Casa\" labelPlacement=\"floating\"\n\t\t\t\tid=\"casa\" interface=\"popover\" formControlName=\"casa\" (ionChange)=\"onChangeCasa($event)\">\n\t\t\t\t<ion-select-option *ngFor=\"let casa of casas\" [value]=\"casa\">{{casa.ID}}--{{casa.NOMBRE}}\n\t\t\t\t</ion-select-option>\n\t\t\t\t<ion-select-option> </ion-select-option>\n\t\t\t\t<ion-select-option></ion-select-option>\n\t\t\t</ion-select>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-input label=\"Nombre\" labelPlacement=\"floating\" id=\"nombre\" type=\"text\" formControlName=\"nombre\">\n\t\t\t</ion-input>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-input label=\"Email\" labelPlacement=\"floating\" id=\"email\" type=\"email\" formControlName=\"email\">\n\t\t\t</ion-input>\n\t\t\t<ion-checkbox id=\"sendEmail\" item-right secondary formControlName=\"sendEmail\" color=\"green\">\n\t\t\t</ion-checkbox>\n\t\t</ion-item>\n\t\t<ion-item>\n\t\t\t<ion-input label=\"Cantidad\" labelPlacement=\"floating\"  id=\"cantidad\" type=\"number\" formControlName=\"cantidad\">\n\t\t\t\t<ion-icon slot=\"start\" name=\"cash\" aria-hidden=\"true\"></ion-icon>\n\t\t\t</ion-input>\n\t\t</ion-item>\n\t\t<!-- Detail -->\n\t\t<div formArrayName=\"conceptos\" margin-bottom>\n\t\t\t<section *ngFor=\"let control of conceptoForm.controls; let i = index\" [formGroupName]=\"i\" >\n\t\t\t\t<ion-item-group>\n\t\t\t\t\t<ion-item-divider color=\"light\">Conceptos #{{ i + 1 }}</ion-item-divider>\n\t\t\t\t\t<ion-item>\n\t\t\t\t\t\t<ion-select label=\"Concepto:\" labelPlacement=\"floating\"  interface=\"popover\" id=\"concepto\" formControlName=\"concepto\" (ionChange)=\"onChangeConcepto($event, i)\">\n\t\t\t\t\t\t\t<ion-select-option *ngFor=\"let row of conceptos\" [value]=\"row.NOMBRE\">\n\t\t\t\t\t\t\t\t{{row.NOMBRE}}\n\t\t\t\t\t\t\t</ion-select-option>\n\t\t\t\t\t\t</ion-select>\n\t\t\t\t\t</ion-item>\n\t\t\t\t\t<ion-item>\n\t\t\t\t\t\t<ion-label floating>Mes:</ion-label>\n\t\t\t\t\t\t\t<!-- <ion-input type=\"date\" maxlength=\"50\" formControlName=\"mes\"></ion-input> -->\n\t\t\t\t\t\t\t<ion-datetime id=\"mes\" displayFormat=\"MMM. YYYY\" formControlName=\"mes\"\n\t\t\t\t\t\t\tmonthShortNames=\"Ene, Feb, Mar, Apr, May, Jun, Jul, Ago, Sep, Oct, Nov, Dic\"\n\t\t\t\t\t\t\tpresentation=\"month-year\"\n\t\t\t\t\t\t[preferWheel]=\"true\">\n\t\t\t\t\t\t</ion-datetime>\n\t\t\t\t\t</ion-item>\n\t\t\t\t\t<ion-item>\n\t\t\t\t\t\t<ion-input label=\"Monto:\" labelPlacement=\"floating\"  id=\"monto\" type=\"number\" maxlength=\"50\" formControlName=\"monto\"></ion-input>\n\t\t\t\t\t</ion-item>\n\t\t\t\t\t<!-- Allow generated input field to be removed -->\n\t\t\t\t\t<ion-button size=\"small\" fill=\"clear\" color=\"danger\" *ngIf=\"conceptoForm.length > 1\"\n                     (click)=\"removeInputField(i)\">\n                     <ion-icon name=\"close\"></ion-icon>\n                     eliminar\n                  </ion-button>\n\t\t\t\t</ion-item-group>\n\t\t\t</section>\n\t\t</div>\n\t\t<!-- Allow new input field to be generated/added -->\n\t\t<ion-button size=\"small\" fill=\"clear\" color=\"primary\"\n            (click)=\"addNewInputField()\">\n            <ion-icon slot=\"start\" name=\"add\"></ion-icon>\n\t\t\tnuevo concepto\n         </ion-button>\n\t\t<ion-button type=\"submit\" expand=\"block\" [disabled]=\"!fields.valid\" >Agregar</ion-button>\n\t</form>\n</ion-content>\n","import { Component, OnInit } from '@angular/core';\nimport {\n  FormArray,\n  FormBuilder,\n  FormGroup,\n  Validators\n} from '@angular/forms';\nimport {\n  ActionSheetController,\n  LoadingController,\n  ModalController\n} from '@ionic/angular';\nimport {\n  Casa,\n  Concepto,\n  ConceptoDef,\n  Recibo,\n  ReciboDetalle,\n  ReciboMaxFolio,\n  Usuario\n} from '../../interface/recibos';\nimport { RecibosService } from '../../service/recibos.service';\nimport { LoadingUtil } from '../../utils/loadingUtil';\nimport { ToastUtil } from '../../utils/toastUtil';\nimport { AlertUtil } from 'src/app/utils/alertUtil';\nimport { PrefijoDef } from '../../interface/recibos';\n\n@Component({\n  selector: 'app-add-recibos',\n  templateUrl: './add-recibos.component.html',\n  styleUrls: ['./add-recibos.component.css'],\n  standalone: false,\n})\n// export class AddRecibosComponent extends LoadingUtil implements OnInit {\nexport class AddRecibosComponent implements OnInit {\n  user: Usuario | null = null;\n  item: Recibo = {\n    FOLIO: 0,\n    CASA: '',\n    NOMBRE: '',\n    CANTIDAD: '',\n    CONCEPTO: '',\n    FECHA: '',\n    CORREO: '',\n    INPUT_TIMESTAMP: '',\n    PREFIX: '',\n  };\n  itemDetail: ReciboDetalle[] = [];\n  casas: Casa[] = [];\n  casa: Casa | any;\n  conceptos: ConceptoDef[] = [];\n  prefijos: PrefijoDef[] = [];\n  data: boolean = false;\n  sendEmail: boolean = false;\n\n  date = new Date(); // Or the date you'd like converted.\n  today = new Date(\n    this.date.getTime() - this.date.getTimezoneOffset() * 60000\n  );\n  public fields: FormGroup;\n\n  constructor(\n    private modalCtrl: ModalController,\n    private actionSheetCtrl: ActionSheetController,\n    private formBuilder: FormBuilder,\n    private service: RecibosService,\n    // loadingCtrl: LoadingController,\n    private loadingUtil: LoadingUtil,\n    private toastUtil: ToastUtil,\n    private alertUtil: AlertUtil\n  ) {\n    // super(loadingCtrl);\n    this.fields = this.formBuilder.group({\n      prefijo: ['', Validators.required],\n      folio: ['', Validators.required],\n      casa: ['', Validators.required],\n      nombre: ['', Validators.required],\n      fecha: ['', Validators.required],\n      email: ['', Validators.required],\n      sendEmail: '',\n      cantidad: ['', Validators.required],\n      conceptos: this.formBuilder.array([this.frmConceptos()])\n    });\n  }\n\n  frmConceptos(): FormGroup {\n    return this.formBuilder.group({\n      concepto: ['', [Validators.required, Validators.minLength(3)]],\n      mes: ['', [Validators.required]],\n      monto: ['', [Validators.required, Validators.min(0), Validators.pattern(/^\\d+(\\.\\d{1,2})?$/)]]\n    });\n  }\n\n  get conceptoForm() {\n    return this.fields.get('conceptos') as FormArray;\n  }\n\n  ngOnInit() {\n    this.service.getSpreadSheetId().then(() => {\n      // const FOLIO = this.getMaxFolio();\n      const formattedDate = this.today.toJSON().split('T')[0];\n      this.fields.patchValue({ fecha: formattedDate });\n      this.inittial();\n      // this.dismiss();\n    });\n    this.loadingUtil.showing();\n  }\n\n  /**\n   * @deprecated Use getMaxFolio with subscription instead\n   */\n  getMaxFolio() {\n    this.service.getFullDataDetail().subscribe(\n      {\n         next: (resp: ReciboDetalle[] | any) => {\n          const FOLIO = Math.max(...resp.map((row: { FOLIO: any; }) => row.FOLIO)) + 1;\n          this.fields.patchValue({ folio: FOLIO });\n          this.loadingUtil.dismiss();\n        }, error: err => {\n          const FOLIO = 1;\n          this.fields.patchValue({ folio: FOLIO });\n          this.loadingUtil.dismiss();\n          this.alertUtil.showError('No se pudo obtener el folio: ' + err.message);\n        }\n      });\n  }\n\n  inittial() {\n    const userStr = localStorage.getItem('user');\n    this.user = userStr ? JSON.parse(userStr) : null;\n    this.service.getFullData().subscribe({\n      next: (resp: Casa[] | any) => {\n      this.casas = resp || [];\n      // this.dismiss();\n      this.service.getConceptos().subscribe((resp: ConceptoDef[] | any) => {\n        this.conceptos = resp || [];\n        // console.log(this.conceptos);\n        // this.getMaxFolio();\n        });\n      this.service.getPrefijos().subscribe((resp: PrefijoDef[] | any) => {\n        this.prefijos = resp || [];\n        let prefijo = this.prefijos.find((data: PrefijoDef) =>\n          data.NOMBRE?.toUpperCase() === this.user?.ID?.toUpperCase() && this.user?.ROLE === 'user'\n        );\n        if (prefijo) {\n          this.fields.patchValue({\n            prefijo: prefijo.NOMBRE,\n            folio: prefijo?.FOLIO + 1\n          });\n        }\n        this.loadingUtil.dismiss();\n        });\n      },\n      error: async (err) => {\n        console.error('Error al cargar datos:', err);\n        this.loadingUtil.dismiss();\n        this.alertUtil.showError('No se pudieron cargar los datos: ' + err.message);\n      }\n    });\n  }\n\n  onChangeCasa(event: CustomEvent) {\n    const _casa: Casa = event.detail.value;\n    if (_casa.ID) {\n      this.casa = this.casas.find((data: Casa) => {\n        if (data.ID === _casa.ID && data.NOMBRE === _casa.NOMBRE) {\n          return data;\n        }\n        return null;\n      });\n\n      this.fields.patchValue({\n        nombre: this.casa.NOMBRE,\n        email: this.casa.EMAIL,\n        sendEmail: true\n      });\n    }\n  }\n\n  onChangePrefijo(event: CustomEvent) {\n    const _prefijo: PrefijoDef = event.detail.value;\n    if (!_prefijo) return;\n    let prefijo = this.prefijos.find((data: PrefijoDef) => data.NOMBRE === _prefijo.NOMBRE);\n    this.fields.patchValue({\n        folio: (prefijo?.FOLIO ?? 0) + 1\n      });\n  }\n\n  onChangeConcepto(event: CustomEvent, i: number) {\n    const _concepto: ConceptoDef = event.detail.value;\n    if (_concepto) {\n      const control = <FormArray>this.fields.controls['conceptos'];\n      let _monto = this.calMontoConcepto();\n      control.at(i).patchValue({\n        mes: this.getFirstDayOfMonth(),\n        monto: _monto\n      });\n    }\n  }\n\n  calMontoConcepto() {\n    const control = <FormArray>this.fields.controls['conceptos'];\n    let sumMonto: number = 0;\n      control.controls.forEach((data: any) => {\n        sumMonto += data.value.monto;\n      });\n      return this.fields.value.cantidad - sumMonto;\n  }\n\n  getFirstDayOfMonth() {\n    const firstDayOfMonth = new Date(this.today.getFullYear(), this.today.getMonth(), 1).toJSON().split('T')[0];\n    return firstDayOfMonth;\n  }\n\n  async onSave(_recibo: any) {\n    const actionSheet = await this.actionSheetCtrl.create({\n      header: '¿Desea guardar el recibo?',\n      buttons: [\n        {\n          text: 'Aceptar',\n          role: 'confirm',\n          icon: 'checkmark',\n          handler: () => {\n            this.save(_recibo);\n          }\n        },\n        {\n          text: 'Cancelar',\n          role: 'cancel',\n          icon: 'close',\n        }\n      ]\n    });\n    await actionSheet.present();\n  }\n\n  save(_recibo: any) {\n    let _casa = _recibo.casa;\n    _recibo.casa = _casa.ID;\n    let _prefix = _recibo.prefijo?.PREFIJO ?? '';\n    _recibo.prefijo = _prefix;\n    this.fillEvent(_recibo);\n    this.service.save(this.item, this.itemDetail).subscribe( {\n      next: resp => {\n        // console.log(\"resp save item\", resp);\n        if (this.sendEmail) {\n          let fecha = new Date(_recibo.fecha);\n          let date = new Date(\n            fecha.getTime() + this.date.getTimezoneOffset() * 60000\n          ); //add 1 day\n          // console.log(_recibo.fecha);\n          _recibo.fecha = date.toLocaleDateString();\n          // console.log(_recibo.fecha);\n          this.service.sendEmail(_recibo, _recibo.conceptos).subscribe({\n            next: resp => {\n              // console.log('resp save item', resp);\n              this.meesageToast('correo enviado');\n            },\n            error: err => {\n              console.log('Error email: ', err);\n            }\n          });\n        }\n        this.meesageToast('Se guardo exitosamente');\n        this.loadingUtil.dismiss();\n        this.itemDetail = this.convertMonth(this.itemDetail);\n        this.confirm(this.itemDetail);\n      },\n      error: err => {\n        //console.log(\"Error Detail: \", err);\n        this.meesageToast('No se pudo guardar el dato');\n        this.loadingUtil.dismiss();\n      }\n  });\n    this.loadingUtil.showing();\n    _recibo.sendEmail = true;\n  }\n\nconvertMonth(itemDetail: ReciboDetalle[]) {\n    return itemDetail.map(item => {\n      // 1. Toma el string y separa\n      const [yyyy, mm, dd] = item.MES?.split('-') || [];\n      // 3. Crea fecha ISO agregando hora\n      const isoString = `${yyyy}-${mm}-${dd}T06:00:00.000Z`;\n      // 4. Devuelve el nuevo objeto con MES modificado\n      return { ...item, MES: isoString };\n    });\n  }\n\n  fillEvent(_recibo: any) {\n    // console.log(\"event\", _recibo);\n    this.item.FOLIO = _recibo.folio;\n    let fecha = new Date(_recibo.fecha);\n    this.item.FECHA = _recibo.fecha;\n    this.item.CASA = _recibo.casa;\n    this.item.NOMBRE = _recibo.nombre;\n    this.item.CORREO = _recibo.email;\n    this.item.CANTIDAD = _recibo.cantidad;\n    this.item.PREFIX = _recibo.prefijo;\n    // console.log(\"this.item\", this.item);\n    var conceptos = _recibo.conceptos;\n    this.itemDetail = [];\n    if (conceptos) {\n      this.item.CONCEPTO = _recibo.conceptos[0].concepto;\n      //console.log(\"conceptos\", conceptos);\n      conceptos.forEach((data: Concepto) => {\n        var detail: ReciboDetalle = {};\n        detail.FOLIO = _recibo.folio;\n        detail.CASA = _recibo.casa;\n        detail.NOMBRE = _recibo.nombre;\n        detail.CONCEPTO = data.concepto;\n        detail.MES = data.mes;\n        detail.MONTO = data.monto;\n        detail.PREFIX = _recibo.prefijo;\n        //console.log(\"detail\", detail);\n        this.itemDetail.push(detail);\n      });\n    }\n    // console.log(\"this.itemDetail\", this.itemDetail);\n  }\n\n  removeInputField(i: number): void {\n    const control = <FormArray>this.fields.controls['conceptos'];\n    control.removeAt(i);\n  }\n\n  addNewInputField(): void {\n    const control = <FormArray>this.fields.controls['conceptos'];\n    control.push(this.frmConceptos());\n  }\n\n  /* async meesageToast(_message: string) {\n    let toast = await this.toastCtrl.create({\n      message: _message,\n      duration: 3000,\n      position: 'top'\n    });\n\n    toast.present();\n  } */\n\n  meesageToast(_message: string) {\n    this.toastUtil.presentToast(_message, \"top\");\n  }\n\n  confirm(reciboDetalles: any) {\n      this.modalCtrl.dismiss(reciboDetalles, 'confirm');\n  }\n\n  close() {\n    this.modalCtrl.dismiss(null, 'cancel');\n  }\n}\n","import { Injectable } from \"@angular/core\";\nimport { AlertController } from \"@ionic/angular\";\n\n@Injectable({ providedIn: 'root' })\nexport class AlertUtil {\n\n  constructor(private alertCtrl: AlertController) {}\n\n  async showSucess(message: string) {\n    const alert = await this.alertCtrl.create({\n      header: 'Exito',\n      message: message,\n      buttons: ['OK'],\n    });\n    await alert.present();\n    console.log('Success:', message);\n  }\n\n  async showError(message: string) {\n    const alert = await this.alertCtrl.create({\n      header: 'Error',\n      message: message,\n      buttons: ['OK'],\n    });\n    await alert.present();\n    console.error('Error:', message);\n  }\n\n}\n"],"x_google_ignoreList":[]}